# TASK.md

このファイルは、Slack Focus Helper Chrome拡張機能の開発タスクリストを管理します。

## 開発フェーズ別タスク

### Phase 1: 基本構造とワークスペース管理 (優先度: 必須)

- [ ] **プロジェクト設定**
  - [ ] WXT設定ファイル（wxt.config.ts）の更新
  - [ ] manifest.jsonの権限設定（storage, contextMenus, activeTab, host_permissions）
  - [ ] TypeScript設定の確認
  - [ ] プロジェクト設定をコミットする
  - [ ] プロジェクト設定をリファクタする

- [ ] **型定義の作成**
  - [ ] `src/types/config.ts` - 設定データの型定義
  - [ ] ワークスペース情報の型定義
  - [ ] 時間設定の型定義
  - [ ] 型定義をコミットする
  - [ ] 型定義をリファクタする

- [ ] **ワークスペース検出機能**
  - [ ] `src/utils/workspace.ts` - ワークスペース検出ロジック
  - [ ] URLからのワークスペースID抽出
  - [ ] DOM要素からのワークスペース名取得
  - [ ] 複数検出方法のフォールバック実装
  - [ ] ワークスペース検出機能をコミットする
  - [ ] ワークスペース検出機能をリファクタする

- [ ] **ストレージ管理**
  - [ ] `src/utils/storage.ts` - Chrome Storage操作
  - [ ] ワークスペース別設定の保存/読み込み
  - [ ] デフォルト設定の生成
  - [ ] 設定データの検証とマイグレーション
  - [ ] ストレージ管理をコミットする
  - [ ] ストレージ管理をリファクタする

### Phase 2: DOM操作基盤 (優先度: 必須)

- [ ] **Slack DOM解析**
  - [ ] `src/utils/dom-constants.ts` - DOMセレクタ定数定義
  - [ ] チャンネルリストのセレクタ特定
  - [ ] セクションヘッダーのセレクタ特定
  - [ ] ワークスペース名要素のセレクタ特定
  - [ ] Slack DOM解析をコミットする
  - [ ] Slack DOM解析をリファクタする

- [ ] **DOM操作ユーティリティ**
  - [ ] `src/utils/slack-dom.ts` - Slack DOM操作関数
  - [ ] 要素の非表示/表示機能
  - [ ] セクション単位での要素操作
  - [ ] チャンネル個別の要素操作
  - [ ] DOM操作ユーティリティをコミットする
  - [ ] DOM操作ユーティリティをリファクタする

- [ ] **動的監視システム**
  - [ ] MutationObserverの実装
  - [ ] DOM変更の検知と対応
  - [ ] パフォーマンス最適化
  - [ ] 動的監視システムをコミットする
  - [ ] 動的監視システムをリファクタする

### Phase 3: コンテンツスクリプト実装 (優先度: 必須)

- [ ] **メインコントローラー**
  - [ ] `entrypoints/content.ts` - SlackFocusControllerクラス
  - [ ] 初期化処理
  - [ ] ワークスペース検出と設定読み込み
  - [ ] 制限状態の管理
  - [ ] メインコントローラーをコミットする
  - [ ] メインコントローラーをリファクタする

- [ ] **ワークスペース切り替え対応**
  - [ ] ワークスペース変更の検知
  - [ ] 設定の動的切り替え
  - [ ] 状態のリセットと再初期化
  - [ ] ワークスペース切り替え対応をコミットする
  - [ ] ワークスペース切り替え対応をリファクタする

- [ ] **時間制御機能**
  - [ ] `src/utils/time.ts` - 時間判定ユーティリティ
  - [ ] 現在時間の時間帯判定
  - [ ] 複数時間帯の対応
  - [ ] 曜日別設定の対応
  - [ ] タイムゾーン対応
  - [ ] 時間制御機能をコミットする
  - [ ] 時間制御機能をリファクタする

### Phase 4: UI実装 (優先度: 推奨)

- [ ] **ポップアップ設定画面**
  - [ ] `entrypoints/popup/App.tsx` - メイン設定画面
  - [ ] ワークスペース選択UI
  - [ ] 機能ON/OFF切り替え
  - [ ] 現在の状態表示
  - [ ] ポップアップ設定画面をコミットする
  - [ ] ポップアップ設定画面をリファクタする

- [ ] **時間設定UI**
  - [ ] 時間帯設定コンポーネント
  - [ ] 曜日別設定UI
  - [ ] 複数時間帯の追加/削除
  - [ ] 時間入力バリデーション
  - [ ] 時間設定UIをコミットする
  - [ ] 時間設定UIをリファクタする

- [ ] **ブロック対象管理UI**
  - [ ] ブロック中セクション一覧表示
  - [ ] ブロック中チャンネル一覧表示
  - [ ] 削除機能
  - [ ] 手動追加フォーム（代替実装）
  - [ ] ブロック対象管理UIをコミットする
  - [ ] ブロック対象管理UIをリファクタする

### Phase 5: 右クリックメニュー (優先度: 推奨)

- [ ] **バックグラウンドスクリプト**
  - [ ] `entrypoints/background.ts` - contextMenus API実装
  - [ ] 右クリックメニュー項目の作成
  - [ ] メニュークリック時の処理
  - [ ] バックグラウンドスクリプトをコミットする
  - [ ] バックグラウンドスクリプトをリファクタする

- [ ] **要素特定とブロック追加**
  - [ ] 右クリックされた要素の特定
  - [ ] セクション/チャンネル名の抽出
  - [ ] 現在のワークスペース設定への追加
  - [ ] 要素特定とブロック追加をコミットする
  - [ ] 要素特定とブロック追加をリファクタする

### Phase 6: URL監視・ブロック (優先度: 拡張)

- [ ] **URL監視システム**
  - [ ] URL変更の検知
  - [ ] ブロック対象URLパターンの判定
  - [ ] SPAナビゲーションへの対応
  - [ ] URL監視システムをコミットする
  - [ ] URL監視システムをリファクタする

- [ ] **ブロック画面**
  - [ ] ブロック画面の表示
  - [ ] リダイレクト処理
  - [ ] ユーザーフレンドリーなメッセージ
  - [ ] ブロック画面をコミットする
  - [ ] ブロック画面をリファクタする

### Phase 7: テスト・最適化 (優先度: 拡張)

- [ ] **テストケース作成**
  - [ ] ワークスペース検出のテスト
  - [ ] 時間判定ロジックのテスト
  - [ ] ワークスペース切り替えのテスト
  - [ ] DOM操作のテスト
  - [ ] テストケース作成をコミットする
  - [ ] テストケース作成をリファクタする

- [ ] **パフォーマンス最適化**
  - [ ] CPU使用量の監視と最適化
  - [ ] メモリ使用量の最適化
  - [ ] DOM監視頻度の調整
  - [ ] パフォーマンス最適化をコミットする
  - [ ] パフォーマンス最適化をリファクタする

- [ ] **エラーハンドリング**
  - [ ] ワークスペース検出失敗時の処理
  - [ ] 設定データ破損時の復旧
  - [ ] DOM構造変更への対応
  - [ ] エラーハンドリングをコミットする
  - [ ] エラーハンドリングをリファクタする

## 現在の進行状況

- [x] プロジェクト初期化完了
- [x] 基本的なWXT設定完了
- [ ] **現在作業中**: 基本構造の実装開始

## 次のステップ

1. **Phase 1の完了**: 基本構造とワークスペース管理機能の実装
2. **Phase 2の着手**: DOM操作基盤の構築
3. **Phase 3の実装**: メインのコンテンツスクリプト機能

## 注意事項

- 各フェーズ完了時に `npm run compile` と `npm run build` を実行してエラーがないことを確認
- SlackのDOM構造は頻繁に変更されるため、複数のセレクタパターンを用意する
- ワークスペース間の設定分離を徹底する
- パフォーマンスを考慮した実装を心がける

## 開発ルール

- **マジックナンバーの禁止**: 定数として適切な場所に定義
- **クリーンなコード**: 可読性が高く、意図が明確なコード
- **単一責任の原則**: 1つの関数は1つの責任のみ
- **タスクごとのビルド確認**: 各タスク完了時に必ずビルドを実行