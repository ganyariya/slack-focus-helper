# TASK.md - 開発タスクリスト

このファイルはSlack Focus Helper Chrome拡張機能の開発タスクを管理します。

## フェーズ1: 基盤実装

### 1.1 プロジェクト設定とマニフェスト設定
- [x] マニフェストV3の権限設定（storage, activeTab, tabs, <all_urls>）
- [x] WXTの設定ファイル更新
- [x] 基本的なディレクトリ構造の確認
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 1.2 詳細データ型定義
- [x] Section Groupのインターフェース定義（TypeScript）
- [x] 時間ブロックのインターフェース定義
- [x] ストレージ構造の型定義
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 1.3 ストレージ管理システム
- [x] chrome.storage.localのラッパー関数作成
- [x] Section Group の CRUD 操作実装
- [x] データの保存・読み込み・削除機能
- [x] 初期データの設定
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

## フェーズ2: コア機能実装

### 2.1 Background Script（Service Worker）
- [x] 基本的なBackground Script構造の実装
- [x] ストレージからSection Group情報の読み込み
- [x] URL判定ロジックの実装（部分一致）
- [x] 時間判定ロジックの実装（HH:MM形式）
- [x] ブロック判定の統合ロジック
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 2.2 Content Script（ページ監視・ブロック実行）
- [x] document_startでの実行設定
- [x] 初回URL判定の実装
- [x] SPA監視機能の実装：
  - [x] History API監視（popstateイベント）
  - [x] ハッシュ変更監視（hashchangeイベント）
  - [x] MutationObserver による DOM 監視
  - [x] 定期的なURL変更チェック（1秒間隔）
- [x] Background Scriptとの通信実装
- [x] ブロック実行時のページリダイレクト
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 2.3 ブロック専用ページ
- [x] ブロック時に表示する専用ページの作成
- [x] "今は開けません！"メッセージの表示
- [x] ブロック理由（グループ名、時間帯）の表示
- [x] 設定変更へのリンク実装
- [x] シンプルで分かりやすいデザイン実装
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

## フェーズ3: UI実装

### 3.1 ポップアップ基本UI
- [x] 350px固定幅のレイアウト作成
- [x] システムフォント、グレーベースの色調設定
- [x] 現在のURL表示エリア
- [x] Section Group一覧表示エリア
- [x] 新しいSection Group作成エリア
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 3.2 Section Group表示コンポーネント
- [x] グループ状態表示：
  - [x] ブロック中（緑色背景）
  - [x] 非ブロック（赤色背景）
  - [x] 無効（グレー背景）
- [x] 有効/無効トグルチェックボックス
- [x] グループ削除ボタン
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 3.3 時間設定UI
- [x] HTML5 time inputの実装
- [x] 時間ブロック追加ボタン
- [x] 個別時間ブロック削除ボタン
- [x] 最低1つの時間ブロック必須制御
- [x] 時間フォーマット検証（HH:MM）
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 3.4 URL管理UI
- [x] URL数のカウント表示
- [x] 長いURL省略表示（40文字制限）
- [x] ホバーで完全URL表示
- [x] 現在のURLを追加ボタン
- [x] 個別URL削除ボタン
- [x] URL重複チェック機能
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

### 3.5 Section Group作成・編集
- [x] 新しいグループ名入力フィールド
- [x] グループ作成ボタン
- [x] グループ名重複チェック
- [x] グループ名編集機能
- [x] リファクタする
- [x] コミットする
- [x] TASK.md を更新する

## フェーズ4: 統合・テスト

### 4.1 機能統合テスト
- [ ] ポップアップからBackground Scriptへの通信テスト
- [ ] Content ScriptからBackground Scriptへの通信テスト
- [ ] ストレージの読み書き動作確認
- [ ] URL判定ロジックのテスト（各種URLパターン）
- [ ] 時間判定ロジックのテスト（境界値含む）
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

### 4.2 SPA対応テスト
- [ ] Slack での動作確認
- [ ] 各種SPA（React, Vue, Angular）での動作確認
- [ ] History API使用サイトでのテスト
- [ ] ハッシュルーティング使用サイトでのテスト
- [ ] URL変更検知の精度確認
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

### 4.3 エラーハンドリングとエッジケース
- [ ] 不正な時間フォーマット入力の処理
- [ ] 存在しないURLの処理
- [ ] ストレージエラーの処理
- [ ] 権限エラーの処理
- [ ] ネットワークエラーの処理
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

## フェーズ5: 最終調整・リリース準備

### 5.1 パフォーマンス最適化
- [ ] Content Scriptの処理負荷軽減
- [ ] ストレージアクセスの最適化
- [ ] メモリ使用量の確認と最適化
- [ ] 不要なログ出力の削除
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

### 5.2 ユーザビリティ改善
- [ ] エラーメッセージの改善
- [ ] 操作フィードバックの追加
- [ ] レスポンシブデザインの確認
- [ ] アクセシビリティの確認
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

### 5.3 最終リリース準備
- [ ] マニフェストの最終確認
- [ ] アイコンファイルの確認
- [ ] パッケージングテスト
- [ ] Chrome Web Storeへの申請準備
- [ ] README.md の更新
- [ ] リファクタする
- [ ] コミットする
- [ ] TASK.md を更新する

## 注意事項

- 各タスク完了時は必ずテスト実行を行う
- Spec.md の仕様に従って実装する
- TypeScriptの型安全性を保つ
- Manifest V3の制約を遵守する
- セキュリティベストプラクティスに従う