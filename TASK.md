# Slack Focus Helper 開発タスクリスト

このドキュメントは、SPEC.mdとCLAUDE.mdに基づいたSlack Focus Helper拡張機能の開発タスクリストです。

## 重要なルール

- **タスク完了時は必ずTASK.mdを更新すること**
  - 完了したタスクのチェックボックスにチェックを入れる
  - 進捗状況を正確に記録する

## 開発の進め方

各フェーズの最後には必ず以下を実行：
1. **リファクタリング** - コードの整理と最適化
2. **コミット** - 変更内容をGitにコミット

## Phase 1: プロジェクト基盤構築

### 目標
WXTプロジェクトの基本セットアップとSlack対応への変更

### タスク
- [x] **entrypoints/content.ts をSlack用に変更**
  - [x] 対象をGoogle.comからSlackドメイン（`*://*.slack.com/*`）に変更
  - [x] 基本的なSlackページ検出ロジックを実装

- [x] **types/config.ts を作成**
  - [x] SPEC.mdに記載されたTypeScript型定義を実装
  - [x] `Config`, `WorkspaceConfig`, `TimeBlock`, `GlobalSettings` インターフェース

- [x] **ConfigManager クラスを作成**
  - [x] Chrome Storage APIとの統合
  - [x] 設定の読み込み・保存機能
  - [x] ワークスペース別設定管理

- [x] **Phase 1 リファクタリング**
  - コードの整理と最適化

- [x] **Phase 1 コミット**
  - Phase 1の変更をGitにコミット

---

## Phase 2: Slack DOM 検出・操作機能

### 目標
Slackページとワークスペースの検出機能実装

### タスク
- [ ] **ワークスペース名取得機能の実装**
  - [ ] SPEC.mdのセレクタを使用してワークスペース名を取得
  - [ ] エラーハンドリングを含む

- [ ] **チャンネル要素の検出とID取得機能の実装**
  - [ ] チャンネルアイテムの検出
  - [ ] チャンネルID、名前、タイプの取得

- [ ] **セクション要素の検出とID取得機能の実装**
  - [ ] セクションヘッダーの検出
  - [ ] セクションID、名前の取得

- [ ] **MutationObserver による動的DOM変更の監視実装**
  - [ ] Slackの動的コンテンツ更新に対応
  - [ ] パフォーマンスを考慮した監視設定

- [ ] **Phase 2 リファクタリング**
  - DOM操作コードの整理と最適化

- [ ] **Phase 2 コミット**
  - Phase 2の変更をGitにコミット

---

## Phase 3: 時間ベースブロック機能

### 目標
時間帯指定によるブロック機能実装

### タスク
- [ ] **現在時刻と設定時間帯の比較ロジック実装**
  - [ ] "HH:MM"形式の時間比較
  - [ ] 複数時間帯への対応

- [ ] **1分毎の時間チェックとブロック状態切り替え実装**
  - [ ] setIntervalによる定期実行
  - [ ] ブロック状態の自動切り替え

- [ ] **ブロック適用・解除のメインロジック実装**
  - [ ] チャンネル・セクションの表示/非表示制御
  - [ ] CSS操作による視覚的なブロック

- [ ] **Phase 3 リファクタリング**
  - 時間管理ロジックの最適化

- [ ] **Phase 3 コミット**
  - Phase 3の変更をGitにコミット

---

## Phase 4: Ctrl+クリック操作機能

### 目標
ユーザーによる手動ブロック操作実装

### タスク
- [ ] **Ctrl+クリックイベントリスナーの実装**
  - [ ] イベント委譲による効率的なリスナー設定
  - [ ] Slackの通常動作を阻害しない実装

- [ ] **チャンネル・セクションのブロック切り替えロジック実装**
  - [ ] 個別アイテムのブロック状態管理
  - [ ] 設定の即座の保存

- [ ] **暗転エフェクトなどの視覚フィードバック実装**
  - [ ] SPEC.md指定の0.3秒暗転エフェクト
  - [ ] ブロック/解除時の異なるエフェクト

- [ ] **トースト通知機能の実装**
  - [ ] 画面右上への2秒間表示
  - [ ] ブロック/解除の状況に応じたメッセージ

- [ ] **Phase 4 リファクタリング**
  - イベントハンドリングコードの最適化

- [ ] **Phase 4 コミット**
  - Phase 4の変更をGitにコミット

---

## Phase 5: ポップアップUI実装

### 目標
React製の設定画面構築

### タスク
- [ ] **メインポップアップ画面の実装**
  - [ ] SPEC.mdのワイヤーフレームに基づくUI
  - [ ] 時間設定、ブロック状況表示

- [ ] **詳細設定画面の実装**
  - [ ] ブロック中アイテム一覧表示
  - [ ] 個別解除・一括解除ボタン

- [ ] **時間帯設定UIコンポーネントの実装**
  - [ ] 時間入力フィールド
  - [ ] 時間帯の追加・削除機能

- [ ] **ポップアップのCSS・スタイリング実装**
  - [ ] SPEC.mdのデザインに準拠
  - [ ] レスポンシブ対応

- [ ] **Phase 5 リファクタリング**
  - Reactコンポーネントの最適化

- [ ] **Phase 5 コミット**
  - Phase 5の変更をGitにコミット

---

## Phase 6: 強制モード実装

### 目標
直接URL アクセスのブロック機能

### タスク
- [ ] **ページナビゲーション監視機能の実装**
  - [ ] URLの変更を監視
  - [ ] ブロック対象ページへのアクセス検出

- [ ] **ブロック画面の表示機能実装**
  - [ ] SPEC.mdの"No!!!"画面デザイン
  - [ ] 設定ページへのリンク

- [ ] **直接URLアクセスのブロックロジック実装**
  - [ ] ブロック対象チャンネルのURL判定
  - [ ] 強制モード有効時の制御

- [ ] **Phase 6 リファクタリング**
  - URL監視・制御ロジックの最適化

- [ ] **Phase 6 コミット**
  - Phase 6の変更をGitにコミット

---

## Phase 7: 統合・テスト・最終調整

### 目標
全機能の統合とテスト

### タスク
- [ ] **SlackChannelBlocker メインクラスの統合実装**
  - [ ] SPEC.mdのクラス設計に基づく統合
  - [ ] 各機能の連携調整

- [ ] **エラーハンドリングと例外処理の実装**
  - [ ] DOM要素が見つからない場合の処理
  - [ ] 設定読み込みエラーの処理

- [ ] **パフォーマンス最適化**
  - [ ] DOM操作の最適化
  - [ ] イベントリスナーの効率化

- [ ] **手動テスト実行と動作確認**
  - [ ] 全機能の動作確認
  - [ ] 異なるSlackワークスペースでのテスト

- [ ] **バグ修正と最終調整**
  - [ ] 発見されたバグの修正
  - [ ] UI/UXの改善

- [ ] **Phase 7 リファクタリング**
  - 最終的なコード整理

- [ ] **Phase 7 コミット**
  - Phase 7の変更をGitにコミット

---

## Phase 8: パッケージング・配布準備

### 目標
拡張機能の配布準備

### タスク
- [ ] **本番ビルドのテストと動作確認**
  - [ ] `npm run build` での動作確認
  - [ ] Firefox版のテストも実行

- [ ] **配布用ZIPファイルの作成**
  - [ ] `npm run zip` での配布パッケージ作成
  - [ ] 必要ファイルの含有確認

- [ ] **配布用ドキュメント・README更新**
  - [ ] 使用方法の説明
  - [ ] インストール手順

- [ ] **Phase 8 リファクタリング**
  - ドキュメントの整理

- [ ] **Phase 8 コミット**
  - Phase 8の変更をGitにコミット

---

## 開発ガイドライン

### 必須事項
- 各フェーズ完了時に必ずリファクタリングとコミットを実行
- SPEC.mdの仕様に厳密に従う
- TypeScriptの型安全性を重視
- SlackのDOM構造変更に対応できる堅牢な実装

### テスト方針
- 実際のSlackワークスペースでの動作確認
- 複数ブラウザでの互換性確認
- エラーケースでの動作確認

### コミットメッセージ例
```
feat: implement Phase 1 basic project setup
feat: add Slack DOM detection functionality  
feat: implement time-based blocking feature
feat: add Ctrl+click interaction handling
feat: create React popup UI components
feat: implement force mode URL blocking
feat: integrate all features and optimize performance
feat: prepare extension for distribution
```

このタスクリストに従って段階的に開発を進めることで、SPEC.mdで定義された機能を確実に実装できます。